<!DOCTYPE html>
<html>
<head>
    <title>Spacing Practice Worksheet</title>

    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
            margin: 0;
            background: #f2f5ff;
        }

        .container {
            width: 90%;
            margin: auto;
            background: white;
            padding: 25px;
            margin-top: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 14px rgba(0,0,0,0.15);
            position: relative;
        }

        h1 {
            text-align: center;
            color: #0e3c7e;
            margin-bottom: 10px;
        }

        p {
            text-align: center;
            font-size: 18px;
            margin-bottom: 20px;
        }

        .worksheet-text {
            font-size: 30px;
            color: #999;
            opacity: 0.4;
            user-select: none;
            line-height: 50px;
        }

        #traceCanvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: auto;
        }

        .toolbar {
            text-align: center;
            margin-top: 20px;
        }

        .tool-btn {
            padding: 8px 15px;
            border-radius: 6px;
            border: none;
            background: #0e3c7e;
            color: white;
            margin: 0 5px;
            cursor: pointer;
        }

        .tool-btn:hover {
            background: #072f66;
        }
    </style>
</head>

<body>

<div class="container" id="workArea">

    <h1>Spacing Practice Worksheet</h1>
    <p>Practice keeping equal spacing between letters and words.</p>

    <div class="worksheet-text">
        {% for item in [
        "A thirsty crow found a pitcher with water, but the water level was too low for him to reach.",
        "Thinking hard, he picked up pebbles one by one and dropped them into the pitcher. Slowly,",
        "the water rose, and the crow drank his fill. He flew away, chirping, 'When you think'",
        "creatively, you can overcome any challenge.'"
        ] %}
            {{ item }}<br>
        {% endfor %}
    </div>

    <canvas id="traceCanvas"></canvas>

</div>

<div class="toolbar">
    <button class="tool-btn" onclick="undo()">Undo</button>
    <button class="tool-btn" onclick="clearCanvas()">Clear</button>
    <button class="tool-btn" onclick="downloadImage()">Download</button>
</div>


<script>
// Resize canvas to match container
function resizeCanvas() {
    let area = document.getElementById("workArea");
    let canvas = document.getElementById("traceCanvas");

    canvas.width = area.clientWidth;
    canvas.height = area.clientHeight;
}
resizeCanvas();
window.onresize = resizeCanvas;


// Canvas drawing logic
const canvas = document.getElementById("traceCanvas");
const ctx = canvas.getContext("2d");

let strokes = [];
let currentStroke = [];
let drawing = false;

canvas.addEventListener("pointerdown", (e) => {
    drawing = true;
    currentStroke = [];
    drawPoint(e);
});

canvas.addEventListener("pointermove", (e) => {
    if (!drawing) return;
    drawPoint(e, true);
});

canvas.addEventListener("pointerup", () => {
    drawing = false;
    strokes.push(currentStroke);
});

function drawPoint(e, draw = false) {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const pressure = e.pressure || 0.5;

    currentStroke.push({ x, y, pressure });

    if (draw) {
        let prev = currentStroke[currentStroke.length - 2];
        if (!prev) return;

        ctx.lineWidth = pressure * 6;
        ctx.lineCap = "round";
        ctx.strokeStyle = "#000";

        ctx.beginPath();
        ctx.moveTo(prev.x, prev.y);
        ctx.lineTo(x, y);
        ctx.stroke();
    }
}


// Undo last stroke
function undo() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    strokes.pop();
    redraw();
}

function redraw() {
    strokes.forEach(stroke => {
        for (let i = 1; i < stroke.length; i++) {
            ctx.lineWidth = stroke[i].pressure * 6;
            ctx.lineCap = "round";
            ctx.strokeStyle = "#000";

            ctx.beginPath();
            ctx.moveTo(stroke[i - 1].x, stroke[i - 1].y);
            ctx.lineTo(stroke[i].x, stroke[i].y);
            ctx.stroke();
        }
    });
}


// Clear entire canvas
function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    strokes = [];
}


// Download as image
function downloadImage() {
    let link = document.createElement("a");
    link.download = "spacing_practice.png";
    link.href = canvas.toDataURL();
    link.click();
}
</script>

</body>
</html>