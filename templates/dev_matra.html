<!DOCTYPE html>
<html>
<head>
    <title>मात्रा स्पष्टता अभ्यास</title>

    <style>
        body {
            font-family: 'Noto Sans', sans-serif;
            margin: 0;
            background: #f5f6ff;
        }

        .container {
            width: 90%;
            margin: auto;
            background: white;
            padding: 25px;
            margin-top: 30px;
            border-radius: 12px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.15);
            position: relative;
        }

        h1 {
            text-align: center;
            margin-bottom: 10px;
            color: #1a3c7c;
        }

        p {
            text-align: center;
            font-size: 18px;
            color: #333;
        }

        .worksheet-text {
            font-size: 36px;
            color: #999;
            opacity: 0.4;
            user-select: none;
            margin-top: 30px;
            line-height: 60px;
        }

        #traceCanvas {
            position: absolute;
            top: 0;
            left: 0;
            pointer-events: auto;
        }

        .toolbar {
            text-align: center;
            margin-top: 20px;
        }

        .tool-btn {
            padding: 8px 15px;
            border-radius: 6px;
            border: none;
            background: #0e3c7e;
            color: white;
            margin: 0 5px;
            cursor: pointer;
        }

        .tool-btn:hover {
            background: #07275a;
        }
    </style>
</head>

<body>

<div class="container" id="workArea">

    <h1>मात्रा स्पष्टता अभ्यास</h1>
    <p>सभी अक्षरों की ऊँचाई और आकार समान रखने का अभ्यास करें।</p>

    <div class="worksheet-text" id="textContainer">
        {% for item in [
        "धर्म , थकान , भोजन , आकाश , क्षमा , किताब , नमस्ते भारत , कमल , नगर",
        "सच्ची मेहनत हमेशा रंग लाती है।"
        ] %} 
            {{ item }}<br>
        {% endfor %}
    </div>

    <canvas id="traceCanvas"></canvas>

</div>

<div class="toolbar">
    <button class="tool-btn" onclick="undo()">Undo</button>
    <button class="tool-btn" onclick="clearCanvas()">Clear</button>
    <button class="tool-btn" onclick="downloadImage()">Download</button>
</div>

<script>
// Resize canvas to match container
function resizeCanvas() {
    let area = document.getElementById("workArea");
    let canvas = document.getElementById("traceCanvas");

    canvas.width = area.clientWidth;
    canvas.height = area.clientHeight;
}
resizeCanvas();
window.onresize = resizeCanvas;

// Drawing logic
const canvas = document.getElementById("traceCanvas");
const ctx = canvas.getContext("2d");

let strokes = [];
let current = [];
let drawing = false;

canvas.addEventListener("pointerdown", (e) => {
    drawing = true;
    current = [];
    addPoint(e);
});
canvas.addEventListener("pointermove", (e) => {
    if (!drawing) return;
    addPoint(e, true);
});
canvas.addEventListener("pointerup", () => {
    drawing = false;
    strokes.push(current);
});

function addPoint(e, drawNow = false) {
    const rect = canvas.getBoundingClientRect();
    const x = e.clientX - rect.left;
    const y = e.clientY - rect.top;
    const pressure = e.pressure || 0.5;

    current.push({ x, y, pressure });

    if (drawNow) {
        let prev = current[current.length - 2];
        if (!prev) return;

        ctx.lineWidth = pressure * 6;
        ctx.lineCap = "round";
        ctx.strokeStyle = "#000";

        ctx.beginPath();
        ctx.moveTo(prev.x, prev.y);
        ctx.lineTo(x, y);
        ctx.stroke();
    }
}

// Undo
function undo() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    strokes.pop();
    redraw();
}
function redraw() {
    strokes.forEach(stroke => {
        for (let i = 1; i < stroke.length; i++) {
            ctx.lineWidth = stroke[i].pressure * 6;
            ctx.lineCap = "round";
            ctx.strokeStyle = "#000";
            ctx.beginPath();
            ctx.moveTo(stroke[i-1].x, stroke[i-1].y);
            ctx.lineTo(stroke[i].x, stroke[i].y);
            ctx.stroke();
        }
    });
}

// Clear
function clearCanvas() {
    ctx.clearRect(0, 0, canvas.width, canvas.height);
    strokes = [];
}

// Download
function downloadImage() {
    let link = document.createElement("a");
    link.download = "devanagari_practice.png";
    link.href = canvas.toDataURL();
    link.click();
}
</script>

</body>
</html>